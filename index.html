<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pre-Employment Training</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 980px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.5;
    }

    h1 {
      text-align: center;
      margin: 8px 0 10px;
    }

    .lang-switcher {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-bottom: 10px;
    }

    .lang-btn {
      padding: 6px 12px;
      font-size: 0.9rem;
      border-radius: 4px;
      border: 1px solid #999;
      background: #f0f0f0;
      cursor: pointer;
      font-weight: 600;
    }

    .lang-btn.active {
      background: #007bff;
      color: #fff;
      border-color: #007bff;
    }

    .intro {
      margin: 10px 0 18px;
      font-size: 1rem;
    }

    .notice {
      background: #fff3cd;
      border: 1px solid #ffecb5;
      padding: 12px 16px;
      border-radius: 6px;
      margin-bottom: 18px;
      font-size: 1rem;
      font-weight: 600;
    }

    .progress {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 10px;
      margin: 12px 0 8px;
      flex-wrap: wrap;
    }

    .progress .left {
      font-weight: 700;
      font-size: 1.05rem;
    }

    .progress .right {
      font-size: 0.95rem;
      color: #444;
    }

    .video-wrapper {
      position: relative;
      padding-bottom: 56.25%; /* 16:9 */
      height: 0;
      overflow: hidden;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: #000;
    }

    .video-wrapper iframe {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      border: 0;
    }

    #ack-step {
      display: none; /* shown only after current video ends */
      margin-top: 16px;
      padding: 14px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background: #f8f9fa;
    }

    #ack-step h2 {
      margin: 0 0 10px;
      font-size: 1.1rem;
    }

    .ack-row {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      margin-bottom: 12px;
    }

    .ack-row input[type="checkbox"] {
      margin-top: 4px;
      transform: scale(1.2);
    }

    #next-btn {
      padding: 10px 18px;
      font-size: 1rem;
      border-radius: 6px;
      border: none;
      background: #007bff;
      color: #fff;
      cursor: not-allowed;
      opacity: 0.6;
    }

    #next-btn.enabled {
      cursor: pointer;
      opacity: 1;
    }

    .small-note {
      font-size: 0.85rem;
      color: #666;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <!-- Language toggle -->
  <div class="lang-switcher">
    <button class="lang-btn active" data-lang="en">English</button>
    <button class="lang-btn" data-lang="es">Español</button>
  </div>

  <h1 id="page-title">Pre-Employment Training</h1>

  <p class="intro" id="intro-text">
    Welcome to your pre-employment training. Before you can continue to the application, you must complete the required training videos below.
  </p>

  <div class="notice">
    <span id="notice-heading">IMPORTANT:</span>
    <span id="notice-body">
      You must watch each training video in full. After each video ends, you must acknowledge completion before the next video will appear.
    </span>
  </div>

  <div class="progress">
    <div class="left" id="video-title">Training Video</div>
    <div class="right" id="video-counter">Video 1 of 8</div>
  </div>

  <!-- YouTube video -->
  <div class="video-wrapper">
    <div id="player"></div>
  </div>

  <!-- Acknowledgment for the current video (shown only after video ends) -->
  <div id="ack-step">
    <h2 id="ack-heading">Training Acknowledgment</h2>
    <div class="ack-row">
      <input type="checkbox" id="ack-checkbox" />
      <label for="ack-checkbox" id="ack-label"></label>
    </div>

    <button id="next-btn" disabled>Continue to Next Video</button>

    <p class="small-note" id="ack-note">
      The next video will not appear until the current video has ended and you have checked the acknowledgment box.
    </p>
  </div>

  <!-- YouTube IFrame API -->
  <script src="https://www.youtube.com/iframe_api"></script>

  <script>
    // --- Your Adobe Sign form URL ---
    const ADOBE_SIGN_URL =
      "https://na2.documents.adobe.com/public/esignWidget?wid=CBFCIBAA3AAABLblqZhBaK_l5Wopm430r1HwIRPnxP8nj-zbKyAsAoqj19EPGbQ6qXlgWD1IspW25_ypXqgI*";

    // --- Video list (order matters) ---
    // IDs extracted from your YouTube links.
    const videos = [
      {
        id: "Tzpz5fko-fg",
        en: "Respirator Safety Training",
        es: "Capacitación de protección respiratoria",
        standard_en: "29 CFR 1910.134 (Respiratory Protection)",
        standard_es: "29 CFR 1910.134 (Protección respiratoria)"
      },
      {
        id: "TEf1Tsx_3MA",
        en: "Fall Protection Training",
        es: "Capacitación de protección contra caídas",
        standard_en: "29 CFR 1926 Subpart M (Fall Protection)",
        standard_es: "29 CFR 1926 Subparte M (Protección contra caídas)"
      },
      {
        id: "HnqabSdAwVg",
        en: "Scaffold Training",
        es: "Capacitación sobre andamios",
        standard_en: "29 CFR 1926 Subpart L (Scaffolds)",
        standard_es: "29 CFR 1926 Subparte L (Andamios)"
      },
      {
        id: "-kQmLYqIR2A",
        en: "Crystalline Silica Training",
        es: "Capacitación sobre sílice cristalina respirable",
        standard_en: "29 CFR 1926.1153 (Respirable Crystalline Silica)",
        standard_es: "29 CFR 1926.1153 (Sílice cristalina respirable)"
      },
      {
        id: "bPoAHmox0BU",
        en: "Lead Training",
        es: "Capacitación sobre plomo",
        standard_en: "29 CFR 1926.62 (Lead)",
        standard_es: "29 CFR 1926.62 (Plomo)"
      },
      {
        id: "b7ArZilnnTE",
        en: "Ladder Safety Training",
        es: "Capacitación de seguridad en escaleras",
        standard_en: "29 CFR 1926.1053 (Ladders)",
        standard_es: "29 CFR 1926.1053 (Escaleras)"
      },
      {
        id: "GrC5-s4CI64",
        en: "Hearing Protection Training",
        es: "Capacitación de protección auditiva",
        standard_en: "29 CFR 1926.52 (Occupational Noise Exposure) and 29 CFR 1926.101 (Hearing Protection)",
        standard_es: "29 CFR 1926.52 (Exposición ocupacional al ruido) y 29 CFR 1926.101 (Protección auditiva)"
      },
      {
        id: "cpCzwyhCUZI",
        en: "HazCom & GHS Training",
        es: "Capacitación de comunicación de peligros y GHS",
        standard_en: "29 CFR 1926.59 / 29 CFR 1910.1200 (Hazard Communication Standard (GHS))",
        standard_es: "29 CFR 1926.59 / 29 CFR 1910.1200 (Norma de comunicación de peligros (GHS))"
      }
    ];

    // --- Translations / UI text ---
    const translations = {
      en: {
        htmlLang: "en",
        titleTag: "Pre-Employment Training",
        pageTitle: "Pre-Employment Training",
        introText:
          "Welcome to your pre-employment training. Before you can continue to the application, you must complete the required training videos below.",
        noticeHeading: "IMPORTANT:",
        noticeBody:
          "You must watch each training video in full. After each video ends, you must acknowledge completion before the next video will appear.",
        ackHeading: "Training Acknowledgment",
        ackTemplate: (videoTitle, standardText) =>
          `I confirm that I have watched the entire “${videoTitle}” video and understand the information presented. ` +
          `I acknowledge that this video is only one part of my overall training, and that additional hands-on and site-specific training may be required. ` +
          `I understand that this training is provided in accordance with OSHA requirements, including ${standardText}.`,
        nextBtn: "Continue to Next Video",
        lastBtn: "Continue to Training Form",
        ackNote:
          "The next video will not appear until the current video has ended and you have checked the acknowledgment box.",
        counter: (i, total) => `Video ${i} of ${total}`,
        confirmForm:
          "You are about to continue to the training form. Continue?"
      },
      es: {
        htmlLang: "es",
        titleTag: "Capacitación previa al empleo",
        pageTitle: "Capacitación previa al empleo",
        introText:
          "Bienvenido a su capacitación previa al empleo. Antes de poder continuar con la solicitud, debe completar los videos de capacitación requeridos a continuación.",
        noticeHeading: "IMPORTANTE:",
        noticeBody:
          "Debe ver cada video de capacitación completo. Después de que termine cada video, debe confirmar su finalización antes de que aparezca el siguiente video.",
        ackHeading: "Reconocimiento de capacitación",
        ackTemplate: (videoTitle, standardText) =>
          `Confirmo que he visto el video completo “${videoTitle}” y entiendo la información presentada. ` +
          `Reconozco que este video es solo una parte de mi capacitación general y que puede requerirse capacitación adicional práctica y específica del sitio. ` +
          `Entiendo que esta capacitación se proporciona de acuerdo con los requisitos de OSHA, incluidos ${standardText}.`,
        nextBtn: "Continuar al siguiente video",
        lastBtn: "Continuar al formulario de capacitación",
        ackNote:
          "El siguiente video no aparecerá hasta que termine el video actual y usted marque la casilla de reconocimiento.",
        counter: (i, total) => `Video ${i} de ${total}`,
        confirmForm:
          "Está a punto de continuar al formulario de capacitación. ¿Desea continuar?"
      }
    };

    // --- State ---
    let currentLang = "en";
    let currentIndex = 0;
    let player = null;
    let currentVideoEnded = false;

    // --- DOM refs ---
    const els = {};

    function setNextButtonLabel() {
      const t = translations[currentLang];
      if (currentIndex === videos.length - 1) {
        els.nextBtn.textContent = t.lastBtn;
      } else {
        els.nextBtn.textContent = t.nextBtn;
      }
    }

    function applyLanguage(lang) {
      currentLang = lang;
      const t = translations[lang];

      document.documentElement.lang = t.htmlLang;
      document.title = t.titleTag;

      els.pageTitle.textContent = t.pageTitle;
      els.introText.textContent = t.introText;
      els.noticeHeading.textContent = t.noticeHeading;
      els.noticeBody.textContent = " " + t.noticeBody;

      els.ackHeading.textContent = t.ackHeading;
      els.ackNote.textContent = t.ackNote;

      // Update per-video UI
      updateVideoHeader();
      updateAckLabel();
      setNextButtonLabel();

      // Toggle button styles
      document.querySelectorAll(".lang-btn").forEach((btn) => {
        btn.classList.toggle("active", btn.dataset.lang === lang);
      });
    }

    function updateVideoHeader() {
      const t = translations[currentLang];
      const v = videos[currentIndex];
      const name = currentLang === "en" ? v.en : v.es;

      els.videoTitle.textContent = name;
      els.videoCounter.textContent = t.counter(currentIndex + 1, videos.length);
    }

    function updateAckLabel() {
      const t = translations[currentLang];
      const v = videos[currentIndex];
      const title = currentLang === "en" ? v.en : v.es;
      const standard = currentLang === "en" ? v.standard_en : v.standard_es;

      els.ackLabel.textContent = t.ackTemplate(title, standard);
    }

    function resetAckUI() {
      currentVideoEnded = false;
      els.ackCheckbox.checked = false;

      // hide ack step until video ends
      els.ackStep.style.display = "none";

      // disable next button
      els.nextBtn.disabled = true;
      els.nextBtn.classList.remove("enabled");
    }

    function showAckUIAfterEnd() {
      currentVideoEnded = true;
      els.ackStep.style.display = "block";
      updateAckLabel();
      setNextButtonLabel();
      els.ackStep.scrollIntoView({ behavior: "smooth" });
    }

    function maybeEnableNext() {
      if (currentVideoEnded && els.ackCheckbox.checked) {
        els.nextBtn.disabled = false;
        els.nextBtn.classList.add("enabled");
      } else {
        els.nextBtn.disabled = true;
        els.nextBtn.classList.remove("enabled");
      }
    }

    function loadCurrentVideo() {
      resetAckUI();
      updateVideoHeader();
      setNextButtonLabel();

      const vid = videos[currentIndex].id;

      if (player && typeof player.loadVideoById === "function") {
        player.loadVideoById(vid);
      }
    }

    // --- YouTube API callback ---
    function onYouTubeIframeAPIReady() {
      player = new YT.Player("player", {
        videoId: videos[0].id,
        playerVars: {
          rel: 0,
          modestbranding: 1
        },
        events: {
          onStateChange: onPlayerStateChange
        }
      });
    }

    function onPlayerStateChange(event) {
      // Only show acknowledgment when the current video ends
      if (event.data === YT.PlayerState.ENDED) {
        showAckUIAfterEnd();
        maybeEnableNext();
      }
    }

    // --- Init ---
    document.addEventListener("DOMContentLoaded", function () {
      // Cache DOM refs
      els.pageTitle = document.getElementById("page-title");
      els.introText = document.getElementById("intro-text");
      els.noticeHeading = document.getElementById("notice-heading");
      els.noticeBody = document.getElementById("notice-body");
      els.videoTitle = document.getElementById("video-title");
      els.videoCounter = document.getElementById("video-counter");

      els.ackStep = document.getElementById("ack-step");
      els.ackHeading = document.getElementById("ack-heading");
      els.ackCheckbox = document.getElementById("ack-checkbox");
      els.ackLabel = document.getElementById("ack-label");
      els.nextBtn = document.getElementById("next-btn");
      els.ackNote = document.getElementById("ack-note");

      // Language buttons
      document.querySelectorAll(".lang-btn").forEach((btn) => {
        btn.addEventListener("click", () => applyLanguage(btn.dataset.lang));
      });

      // Ack checkbox logic
      els.ackCheckbox.addEventListener("change", maybeEnableNext);

      // Next button logic:
      // - Videos 1..7: load next video
      // - Video 8: go to Adobe Sign form
      els.nextBtn.addEventListener("click", function (e) {
        e.preventDefault();
        e.stopPropagation();

        if (els.nextBtn.disabled) return;

        if (currentIndex < videos.length - 1) {
          currentIndex += 1;
          loadCurrentVideo();
        } else {
          const t = translations[currentLang];
          const confirmed = confirm(t.confirmForm);
          if (!confirmed) return;
          window.location.href = ADOBE_SIGN_URL;
        }
      });

      // Default language + initial UI
      applyLanguage("en");
      loadCurrentVideo();
    });
  </script>
</body>
</html>
